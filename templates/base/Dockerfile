FROM scratch

# Common configuration
{{[- if .API.Enabled ]}}
ENV {{[ toENV .Project.Name ]}}_SERVER_PORT {{[ .API.Config.Port ]}}
{{[- if .API.Gateway ]}}
ENV {{[ toENV .Project.Name ]}}_SERVER_GATEWAY_PORT {{[ .API.Config.Gateway.Port ]}}
{{[- end ]}}
{{[- end ]}}
ENV {{[ toENV .Project.Name ]}}_INFO_PORT 8080
ENV {{[ toENV .Project.Name ]}}_LOGGER_LEVEL 0

# Exposing ports
{{[- if .API.Enabled ]}}
EXPOSE ${{[ toENV .Project.Name ]}}_SERVER_PORT
{{[- if .API.Gateway ]}}
EXPOSE ${{[ toENV .Project.Name ]}}_SERVER_GATEWAY_PORT
{{[- end ]}}
{{[- end ]}}
EXPOSE ${{[ toENV .Project.Name ]}}_INFO_PORT

# Copy dependecies
COPY certs /etc/ssl/certs/
{{[- if .Storage.Enabled ]}}
COPY migrations /migrations/
{{[- end ]}}
COPY bin/linux-amd64/{{[ .Project.Bin ]}} /

CMD ["/{{[ .Project.Bin ]}}", "serve"]
